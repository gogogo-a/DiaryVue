| ***\**\*接口名称\*\**\*** | ***\**\*接口功能\*\**\***      |                       | ***\**\*请求方法\*\**\*** | ***\**\*请求头\*\**\***                            | ***\**\*请求体 (格式)\*\**\*** | ***\**\*请求参数\*\**\***                        | ***\**\*响应结构\*\**\***                                    | ***\**\*成功响应示例\*\**\***                                | ***\**\*失败响应示例\*\**\***                                | ***\**\*备注\*\**\*** |
| ------------------------- | ------------------------------ | --------------------- | ------------------------- | -------------------------------------------------- | ------------------------------ | ------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | --------------------- |
| 用户登录                  | 通过微信code获取用户信息并登录 | /api/v1/auth/wx-login | POST                      | ***\**\*URL\*\**\***Content-Type: application/json | JSON                           | `{ "code": "0b3v9FGa1kldfD0ozaJa1sBcGZ3v9FGF" }` | `{ "code": 200, "message": "", "data": { "user": {...}, "token": "..." } }` | `{ "code": 200, "message": "成功", "data": { "user": { "id": "uuid-string-here", "plant_id": "微信openid", "plant_form": "wechat", "user_name": "微信用户", "password": "", "avatar": "", "email": "", "phone": "", "gender": "", "birthday": "0001-01-01T00:00:00Z", "address": "", "remark": "", "created_at": "2025-09-16T12:34:56Z", "updated_at": "2025-09-16T12:34:56Z" }, "token": "eyJhbGciOiJI..." } }` | `{ "code": 500, "message": "微信API返回错误: invalid appid, rid: 68c90372-2b669432-6b53d6f4", "data": null }` | 后续请求必须携带token |

| ***\**\*接口名称\*\**\*** | ***\**\*接口功能\*\**\***          | ***\**\*URL\*\**\*** | ***\**\*请求方法\*\**\*** | ***\**\*请求头\*\**\***       | ***\**\*请求体 (格式)\*\**\*** | ***\**\*请求参数\*\**\***                                    | ***\**\*响应结构\*\**\***                                    | ***\**\*成功响应示例\*\**\***                                | ***\**\*失败响应示例\*\**\***                                | ***\**\*备注\*\**\*** |
| ------------------------- | ---------------------------------- | -------------------- | ------------------------- | ----------------------------- | ------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | --------------------- |
| 获取用户列表              | 获取用户列表，支持分页和关键词搜索 | /api/v1/users        | GET                       | Authorization: Bearer {token} | 无                             | page: 页码，默认为1page_size: 每页数量，默认为10，最大100keyword: 搜索关键词 | `{ "code": 200, "message": "", "data": { "list": [...], "total": 100, "page": 1, "page_size": 10 } }` | `{ "code": 200, "message": "", "data": { "list": [ { "id": "uuid-string-here", "plant_id": "微信openid", "plant_form": "wechat", "user_name": "微信用户", "avatar": "", "email": "", "phone": "", "gender": "", "birthday": "0001-01-01T00:00:00Z", "address": "", "remark": "", "created_at": "2025-09-16T12:34:56Z", "updated_at": "2025-09-16T12:34:56Z" } ], "total": 1, "page": 1, "page_size": 10 } }` | `{ "code": 401, "message": "未找到用户信息", "data": null }` | 需要认证              |
| 获取用户详情              | 获取特定用户的详细信息             | /api/v1/users/:id    | GET                       | Authorization: Bearer {token} | 无                             | id: 用户ID (UUID格式，通过URL路径参数传递)                   | `{ "code": 200, "message": "", "data": {...} }`              | `{ "code": 200, "message": "", "data": { "id": "uuid-string-here", "plant_id": "微信openid", "plant_form": "wechat", "user_name": "微信用户", "avatar": "", "email": "", "phone": "", "gender": "", "birthday": "0001-01-01T00:00:00Z", "address": "", "remark": "", "created_at": "2025-09-16T12:34:56Z", "updated_at": "2025-09-16T12:34:56Z" } }` | `{ "code": 404, "message": "用户不存在", "data": null }`     | 需要认证              |

##### 账单管理

| ***\*接口名称\**** | ***\*接口功能\****                 | ***\*URL\****       | ***\*请求方法\**** | ***\*请求头\****                                             | ***\*请求体 (格式)\**** | ***\*请求参数\****                                           | ***\*响应结构\****                                           | ***\*成功响应示例\****                                       | ***\*失败响应示例\****                                       | ***\*备注\****                                               |
| ------------------ | ---------------------------------- | ------------------- | ------------------ | ------------------------------------------------------------ | ----------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 创建账单           | 创建新账单                         | /api/v1/bills       | POST               | Authorization: Bearer {token} Content-Type: application/json | JSON                    | `{ "account_book_id": "账本UUID", "amount": 100.00, "type": "income/expense", "tag_ids": ["标签UUID1", "标签UUID2"], "bill_time": "2023-01-01T00:00:00Z", "remark": "备注", "image_url": "图片URL" }` | `{ "code": 200, "message": "", "data": {...} }`              | `{ "code": 200, "message": "创建账单成功", "data": { "id": "uuid-string-here", "account_book_id": "账本UUID", "user_id": "用户UUID", "amount": 100.00, "type": "income", "tags": [{"id": "标签UUID1", "tag_name": "工资"}, {"id": "标签UUID2", "tag_name": "兼职"}], "remark": "备注", "image_url": "图片URL", "created_at": "2025-09-16T12:34:56Z", "updated_at": "2025-09-16T12:34:56Z" } }` | `{ "code": 403, "message": "您没有权限访问此账本", "data": null }` | 需要认证，且必须有对应账本的访问权限。支持多个标签关联到同一个账单 |
| 获取账单列表       | 获取账单列表，支持分页和多条件搜索 | /api/v1/bills       | GET                | Authorization: Bearer {token}                                | 无                      | account_book_id: 账本ID (必填) page: 页码，默认为1 page_size: 每页数量，默认为10，最大100 type: 账单类型 (income/expense) tag_ids: 标签ID数组，多个以逗号分隔 start_time: 开始时间 (YYYY-MM-DD) end_time: 结束时间 (YYYY-MM-DD) min_amount: 最小金额 max_amount: 最大金额 keyword: 搜索关键词 | `{ "code": 200, "message": "", "data": { "list": [...], "total": 100, "page": 1, "page_size": 10 } }` | `{ "code": 200, "message": "", "data": { "list": [ { "id": "uuid-string-here", "account_book_id": "账本UUID", "user_id": "用户UUID", "amount": 100.00, "type": "income", "tags": [{"id": "标签UUID1", "tag_name": "工资"}, {"id": "标签UUID2", "tag_name": "兼职"}], "remark": "备注", "image_url": "图片URL", "created_at": "2025-09-16T12:34:56Z", "updated_at": "2025-09-16T12:34:56Z" } ], "total": 1, "page": 1, "page_size": 10 } }` | `{ "code": 403, "message": "您没有权限访问此账本", "data": null }` | 需要认证，且必须有对应账本的访问权限。支持按多个标签筛选     |
| 更新账单           | 更新账单信息                       | /api/v1/bills/:id   | PUT                | Authorization: Bearer {token} Content-Type: application/json | JSON                    | `{ "account_book_id": "账本UUID", "amount": 100.00, "type": "income/expense", "tag_ids": ["标签UUID1", "标签UUID2"], "bill_time": "2023-01-01T00:00:00Z", "remark": "备注", "image_url": "图片URL" }` | `{ "code": 200, "message": "", "data": {...} }`              | `{ "code": 200, "message": "更新账单成功", "data": { "id": "uuid-string-here", "account_book_id": "账本UUID", "user_id": "用户UUID", "amount": 100.00, "type": "income", "tags": [{"id": "标签UUID1", "tag_name": "工资"}, {"id": "标签UUID2", "tag_name": "兼职"}], "remark": "备注", "image_url": "图片URL", "created_at": "2025-09-16T12:34:56Z", "updated_at": "2025-09-16T12:34:56Z" } }` | `{ "code": 404, "message": "账单不存在", "data": null }`     | 需要认证，且必须有对应账本的访问权限。更新时会先删除原有标签关联，然后重新创建新的标签关联 |
| 删除账单           | 删除账单                           | /api/v1/bills/:id   | DELETE             | Authorization: Bearer {token}                                | 无                      | id: 账单ID (UUID格式，通过URL路径参数传递)                   | `{ "code": 200, "message": "", "data": null }`               | `{ "code": 200, "message": "删除账单成功", "data": null }`   | `{ "code": 403, "message": "您没有权限访问此账本", "data": null }` | 需要认证，且必须有对应账本的访问权限。删除账单的同时会删除相关的账单标签关联 |
| 获取账单详情       | 获取账单详细信息                   | /api/v1/bills/:id   | GET                | Authorization: Bearer {token}                                | 无                      | id: 账单ID (UUID格式，通过URL路径参数传递)                   | `{ "code": 200, "message": "", "data": {...} }`              | `{ "code": 200, "message": "", "data": { "id": "uuid-string-here", "account_book_id": "账本UUID", "user_id": "用户UUID", "amount": 100.00, "type": "income", "tags": [{"id": "标签UUID1", "tag_name": "工资"}, {"id": "标签UUID2", "tag_name": "兼职"}], "remark": "备注", "image_url": "图片URL", "created_at": "2025-09-16T12:34:56Z", "updated_at": "2025-09-16T12:34:56Z" } }` | `{ "code": 404, "message": "账单不存在", "data": null }`     | 需要认证，且必须有对应账本的访问权限。返回账单详情包括关联的标签信息 |
| 获取账单统计       | 获取账单统计信息                   | /api/v1/bills/stats | GET                | Authorization: Bearer {token}                                | 无                      | account_book_id: 账本ID (必填) start_time: 开始时间 (YYYY-MM-DD) end_time: 结束时间 (YYYY-MM-DD) group_by: 分组方式 (day/week/month/year) | `{ "code": 200, "message": "", "data": {...} }`              | `{ "code": 200, "message": "", "data": { "total_income": 1000.00, "total_expense": 500.00, "net_amount": 500.00, "group_stats": [ { "group_key": "2025-09", "income": 1000.00, "expense": 500.00, "net_amount": 500.00 } ], "tag_stats": { "工资": 1000.00, "餐饮": 300.00, "交通": 200.00 } } }` | `{ "code": 403, "message": "您没有权限访问此账本", "data": null }` | 需要认证，且必须有对应账本的访问权限。按标签统计会统计关联到不同标签的账单金额 |

##### 账本管理

| ***\*接口名称\**** | ***\*接口功能\****               | ***\*URL\****             | ***\*请求方法\**** | ***\*请求头\****                                             | ***\*请求体 (格式)\**** | ***\*请求参数\****                                          | ***\*响应结构\****                              | ***\*成功响应示例\****                                       | ***\*失败响应示例\****                                       | ***\*备注\****                       |
| ------------------ | -------------------------------- | ------------------------- | ------------------ | ------------------------------------------------------------ | ----------------------- | ----------------------------------------------------------- | ----------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------ |
| 创建账本           | 创建新账本                       | /api/v1/account-books     | POST               | Authorization: Bearer {token} Content-Type: application/json | JSON                    | `{ "name": "我的账本", "description": "这是我的个人账本" }` | `{ "code": 200, "message": "", "data": {...} }` | `{ "code": 200, "message": "创建成功", "data": { "id": "uuid-string-here", "name": "我的账本", "description": "这是我的个人账本", "created_at": "2025-09-16T12:34:56Z", "updated_at": "2025-09-16T12:34:56Z" } }` | `{ "code": 400, "message": "请求参数错误", "data": null }`   | 需要认证，创建者自动成为账本的管理员 |
| 获取账本列表       | 获取当前用户有权限访问的所有账本 | /api/v1/account-books     | GET                | Authorization: Bearer {token}                                | 无                      | 无                                                          | `{ "code": 200, "message": "", "data": [...] }` | `{ "code": 200, "message": "", "data": [ { "id": "uuid-string-here", "name": "我的账本", "description": "这是我的个人账本", "created_at": "2025-09-16T12:34:56Z", "updated_at": "2025-09-16T12:34:56Z" } ] }` | `{ "code": 401, "message": "未找到用户信息", "data": null }` | 需要认证                             |
| 更新账本           | 更新账本信息                     | /api/v1/account-books/:id | PUT                | Authorization: Bearer {token} Content-Type: application/json | JSON                    | `{ "name": "新账本名称" }`                                  | `{ "code": 200, "message": "", "data": {...} }` | `{ "code": 200, "message": "更新成功", "data": { "id": "uuid-string-here", "name": "新账本名称", "description": "这是我的个人账本", "created_at": "2025-09-16T12:34:56Z", "updated_at": "2025-09-16T12:34:56Z" } }` | `{ "code": 403, "message": "您没有权限修改此账本", "data": null }` | 需要认证，且必须有对应账本的访问权限 |
| 删除账本           | 删除账本                         | /api/v1/account-books/:id | DELETE             | Authorization: Bearer {token}                                | 无                      | id: 账本ID (UUID格式，通过URL路径参数传递)                  | `{ "code": 200, "message": "", "data": null }`  | `{ "code": 200, "message": "删除成功", "data": null }`       | `{ "code": 403, "message": "您没有权限删除此账本", "data": null }` | 需要认证，且必须是账本的管理员       |
| 获取账本详情       | 获取账本详细信息                 | /api/v1/account-books/:id | GET                | Authorization: Bearer {token}                                | 无                      | id: 账本ID (UUID格式，通过URL路径参数传递)                  | `{ "code": 200, "message": "", "data": {...} }` | `{ "code": 200, "message": "", "data": { "id": "uuid-string-here", "name": "我的账本", "description": "这是我的个人账本", "created_at": "2025-09-16T12:34:56Z", "updated_at": "2025-09-16T12:34:56Z" } }` | `{ "code": 404, "message": "账本不存在", "data": null }`     | 需要认证，且必须有对应账本的访问权限 |

##### 账本用户权限

| ***\*接口名称\**** | ***\*接口功能\****                       | ***\*URL\****                           | ***\*请求方法\**** | ***\*请求头\****                                             | ***\*请求体 (格式)\**** | ***\*请求参数\****                                         | ***\*响应结构\****                              | ***\*成功响应示例\****                                       | ***\*失败响应示例\****                                       | ***\*备注\****                                               |
| ------------------ | ---------------------------------------- | --------------------------------------- | ------------------ | ------------------------------------------------------------ | ----------------------- | ---------------------------------------------------------- | ----------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 获取账本用户列表   | 获取账本的所有用户                       | /api/v1/account-book-users/book/:bookId | GET                | Authorization: Bearer {token}                                | 无                      | bookId: 账本ID (UUID格式，通过URL路径参数传递)             | `{ "code": 200, "message": "", "data": [...] }` | `{ "code": 200, "message": "", "data": [ { "id": "uuid-string-here", "plant_id": "微信openid", "plant_form": "wechat", "user_name": "微信用户", "avatar": "", "email": "", "phone": "", "gender": "", "birthday": "0001-01-01T00:00:00Z", "address": "", "remark": "", "created_at": "2025-09-16T12:34:56Z", "updated_at": "2025-09-16T12:34:56Z" } ] }` | `{ "code": 404, "message": "账本不存在或您没有权限", "data": null }` | 需要认证，且必须有对应账本的访问权限                         |
| 授予账本权限       | 员为其他用户授予账本访问权限（共享账本） | /api/v1/account-book-users/grant        | POST               | Authorization: Bearer {token} Content-Type: application/json | JSON                    | `{ "account_book_id": "账本UUID", "user_id": "用户UUID" }` | `{ "code": 200, "message": "", "data": null }`  | `{ "code": 200, "message": "成功授予用户访问权限", "data": null }` | `{ "code": 403, "message": "您没有权限授予此账本的访问权限", "data": null }` | 需要认证，且必须是账本的管理员（第一个用户）                 |
| 撤销账本权限       | 撤销其他用户的账本访问权限               | /api/v1/account-book-users/revoke       | DELETE             | Authorization: Bearer {token} Content-Type: application/json | JSON                    | `{ "account_book_id": "账本UUID", "user_id": "用户UUID" }` | `{ "code": 200, "message": "", "data": null }`  | `{ "code": 200, "message": "成功撤销用户访问权限", "data": null }` | `{ "code": 404, "message": "该用户没有此账本的权限", "data": null }` | 需要认证，且必须是账本的管理员（第一个用户），管理员不能撤销自己的权限 |