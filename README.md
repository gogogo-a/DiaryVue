# DiaryVue - åŸºäºTaroå’ŒVue 3çš„æ—¥è®°å°ç¨‹åº

DiaryVueæ˜¯ä¸€ä¸ªä½¿ç”¨Taroæ¡†æ¶å’ŒVue 3å¼€å‘çš„å¾®ä¿¡å°ç¨‹åºï¼Œä¸“æ³¨äºæä¾›ç®€æ´ã€ç¾è§‚çš„æ—¥è®°è®°å½•ä½“éªŒã€‚é¡¹ç›®é‡‡ç”¨äº†ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ï¼Œæ”¯æŒé»˜è®¤ä¸»é¢˜å’Œæ€€æ—§ä¸»é¢˜ï¼Œå¹¶å…·æœ‰è‰¯å¥½çš„ç»„ä»¶åŒ–ç»“æ„ã€‚
# Taro å®˜æ–¹æ–‡æ¡£
https://docs.taro.zone/docs/GETTING-STARTED
# å›¾ç‰‡å‹ç¼©ç½‘ç«™ï¼Œè½¬webp
https://towebp.io/jpg-to-webp
# iconç½‘ç«™æ‰¾svgçš„
https://www.iconpacks.net/free-icon/location-2952.html#google_vignette
## é¡¹ç›®

```
DiaryVue/
  â”œâ”€â”€ babel.config.js        # Babelé…ç½®
  â”œâ”€â”€ config/                # é¡¹ç›®é…ç½®
  â”‚   â”œâ”€â”€ dev.js            # å¼€å‘ç¯å¢ƒé…ç½®
  â”‚   â”œâ”€â”€ index.js          # åŸºç¡€é…ç½®
  â”‚   â””â”€â”€ prod.js           # ç”Ÿäº§ç¯å¢ƒé…ç½®
  â”œâ”€â”€ package.json          # ä¾èµ–ç®¡ç†
  â”œâ”€â”€ project.config.json   # å¾®ä¿¡å°ç¨‹åºé…ç½®
  â”œâ”€â”€ project.tt.json       # å¤´æ¡å°ç¨‹åºé…ç½®
  â””â”€â”€ src/                  # æºä»£ç 
      â”œâ”€â”€ app.config.js     # åº”ç”¨é…ç½®
      â”œâ”€â”€ app.css           # å…¨å±€æ ·å¼
      â”œâ”€â”€ app.js            # åº”ç”¨å…¥å£
      â”œâ”€â”€ assets/           # é™æ€èµ„æº
      â”‚   â””â”€â”€ images/       # å›¾ç‰‡èµ„æº
      â”‚       â””â”€â”€ svg/      # SVGå›¾æ ‡
      â”œâ”€â”€ components/       # ç»„ä»¶ç›®å½•
      â”‚   â”œâ”€â”€ index/        # é¦–é¡µç»„ä»¶
      â”‚   â”œâ”€â”€ diary/        # æ—¥è®°é¡µç»„ä»¶
      â”‚   â””â”€â”€ public/       # å…¬å…±ç»„ä»¶
      â”œâ”€â”€ pages/            # é¡µé¢ç›®å½•
      â”‚   â”œâ”€â”€ index/        # é¦–é¡µ
      â”‚   â””â”€â”€ diary/        # æ—¥è®°é¡µ
      â”œâ”€â”€ router/           # è·¯ç”±é…ç½®
      â”œâ”€â”€ stores/           # çŠ¶æ€ç®¡ç†
      â”‚   â”œâ”€â”€ counter.js    # è®¡æ•°å™¨çŠ¶æ€
      â”‚   â””â”€â”€ theme.js      # ä¸»é¢˜çŠ¶æ€
      â”œâ”€â”€ styles/           # æ ·å¼ç›®å½•
      â”‚   â”œâ”€â”€ themes.scss   # ä¸»é¢˜å˜é‡
      â”‚   â”œâ”€â”€ themes.js     # ä¸»é¢˜é…ç½®
      â”‚   â””â”€â”€ variables.scss # å…¨å±€å˜é‡
      â””â”€â”€ utils/            # å·¥å…·å‡½æ•°
          â””â”€â”€ themeManager.js # ä¸»é¢˜ç®¡ç†å™¨
```

## æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Taro + Vue 3
- **çŠ¶æ€ç®¡ç†**: Pinia
- **æ ·å¼**: SCSS
- **æ„å»ºå·¥å…·**: Webpack
- **å°ç¨‹åºå¹³å°**: å¾®ä¿¡å°ç¨‹åº

## ç¼–ç è§„èŒƒ

### å‘½åè§„èŒƒ

1. **æ–‡ä»¶å‘½å**:
   - ç»„ä»¶æ–‡ä»¶: ä½¿ç”¨PascalCase (å¦‚ `ThemeSwitch.vue`)
   - å·¥å…·/é…ç½®æ–‡ä»¶: ä½¿ç”¨camelCase (å¦‚ `themeManager.js`)
   - æ ·å¼æ–‡ä»¶: ä¸ç»„ä»¶åŒå (å¦‚ `ThemeSwitch.scss`)

2. **å˜é‡å‘½å**:
   - å¸¸é‡: ä½¿ç”¨UPPER_SNAKE_CASE (å¦‚ `THEMES.DEFAULT`)
   - å˜é‡: ä½¿ç”¨camelCase (å¦‚ `currentTheme`)
   - ç§æœ‰å˜é‡: ä½¿ç”¨ä¸‹åˆ’çº¿å‰ç¼€ (å¦‚ `_privateVar`)

3. **ç»„ä»¶å‘½å**:
   - ä½¿ç”¨PascalCase (å¦‚ `<ThemeSwitch>`)
   - é¡µé¢ç»„ä»¶æ·»åŠ Pageåç¼€ (å¦‚ `IndexPage`)

### æ ·å¼è§„èŒƒ

1. **CSSå˜é‡**:
   - ä¸»é¢˜ç›¸å…³å˜é‡: ä½¿ç”¨CSSå˜é‡ (å¦‚ `--primary-color`)
   - å…¨å±€é™æ€å˜é‡: ä½¿ç”¨SCSSå˜é‡ (å¦‚ `$padding-size`)

2. **æ ·å¼ç»“æ„**:
   - ç»„ä»¶æ ·å¼: ä¸ç»„ä»¶åŒçº§ç›®å½•ï¼ŒåŒåæ–‡ä»¶
   - å…¨å±€æ ·å¼: æ”¾åœ¨`styles`ç›®å½•ä¸‹
   - ä¸»é¢˜å˜é‡: ç»Ÿä¸€åœ¨`themes.scss`ä¸­å®šä¹‰

3. **æ ·å¼å‘½å**:
   - ä½¿ç”¨kebab-case (å¦‚ `.theme-switch`)
   - ä½¿ç”¨BEMå‘½åæ³• (Block-Element-Modifier)

### ç»„ä»¶è§„èŒƒ

1. **ç»„ä»¶ç»“æ„**:
   ```vue
   <template>
     <!-- æ¨¡æ¿å†…å®¹ -->
   </template>

   // å¯¼å…¥
   import { defineOptions, ref } from 'vue'
   import './ComponentName.scss'

   // ç»„ä»¶é€‰é¡¹
   defineOptions({
     name: 'ComponentName'
   })

   // çŠ¶æ€å’Œé€»è¾‘
   const state = ref(initialValue)

   // æ–¹æ³•
   const handleEvent = () => {
     // å¤„ç†é€»è¾‘
   }
   </script>
   ```

2. **ç»„ä»¶åˆ†ç±»**:
   - é¡µé¢ç»„ä»¶: æ”¾åœ¨`pages`ç›®å½•ä¸‹
   - ä¸šåŠ¡ç»„ä»¶: æ”¾åœ¨å¯¹åº”é¡µé¢çš„`components`å­ç›®å½•ä¸‹
   - å…¬å…±ç»„ä»¶: æ”¾åœ¨`components/public`ç›®å½•ä¸‹

## æ–‡ä»¶åˆ›å»ºä¹ æƒ¯

1. **æ–°ç»„ä»¶åˆ›å»º**:
   - ä¸ºæ¯ä¸ªç»„ä»¶åˆ›å»ºå•ç‹¬çš„ç›®å½•
   - ç›®å½•ä¸­åŒ…å«`.vue`å’Œ`.scss`æ–‡ä»¶
   - ç»„ä»¶ç›®å½•ä¸ç»„ä»¶åŒå

   ä¾‹å¦‚:
   ```
   components/
     â””â”€â”€ ThemeSwitch/
         â”œâ”€â”€ ThemeSwitch.vue
         â””â”€â”€ ThemeSwitch.scss
   ```

2. **é¡µé¢åˆ›å»º**:
   - åœ¨`pages`ç›®å½•ä¸‹åˆ›å»ºé¡µé¢ç›®å½•
   - ç›®å½•ä¸­åŒ…å«`.vue`, `.scss`å’Œ`.config.js`æ–‡ä»¶
   - é¡µé¢é…ç½®æ–‡ä»¶ä¸é¡µé¢åŒå

   ä¾‹å¦‚:
   ```
   pages/
     â””â”€â”€ diary/
         â”œâ”€â”€ diary.vue
         â”œâ”€â”€ diary.scss
         â””â”€â”€ diary.config.js
   ```

3. **èµ„æºæ–‡ä»¶**:
   - å›¾ç‰‡èµ„æºæ”¾åœ¨`assets/images`ç›®å½•ä¸‹
   - SVGå›¾æ ‡æŒ‰åŠŸèƒ½åˆ†ç±»å­˜æ”¾åœ¨`assets/svg`çš„å­ç›®å½•ä¸­

## ä¸»é¢˜ç³»ç»Ÿ

é¡¹ç›®å®ç°äº†ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ï¼ŒåŒ…æ‹¬é»˜è®¤ä¸»é¢˜å’Œæ€€æ—§ä¸»é¢˜ã€‚ä¸»é¢˜ç³»ç»Ÿçš„æ ¸å¿ƒåŒ…æ‹¬:

1. **ä¸»é¢˜å˜é‡å®šä¹‰**: åœ¨`styles/themes.scss`ä¸­ä½¿ç”¨CSSå˜é‡å®šä¹‰ä¸»é¢˜é¢œè‰²
2. **ä¸»é¢˜åˆ‡æ¢é€»è¾‘**: åœ¨`utils/themeManager.js`ä¸­å®ç°ä¸»é¢˜çš„ä¿å­˜å’Œåˆ‡æ¢
3. **å…¨å±€çŠ¶æ€ç®¡ç†**: ä½¿ç”¨Piniaçš„`stores/theme.js`ç®¡ç†å…¨å±€ä¸»é¢˜çŠ¶æ€
4. **ä¸»é¢˜åº”ç”¨**: åœ¨ç»„ä»¶ä¸­é€šè¿‡`:class="themeStore.currentThemeClass"`åº”ç”¨ä¸»é¢˜

## é¡¹ç›®å¯åŠ¨å’Œæ„å»º

### ç¯å¢ƒè¦æ±‚

- Node.js ==22.17.0
- ä½¿ç”¨pnpm

### å®‰è£…ä¾èµ–
```bash
pnpm install
```

### å¼€å‘æ¨¡å¼

```bash
# å¾®ä¿¡å°ç¨‹åº
pnpm dev:weapp --watch
```

### é¢„è§ˆå’Œè°ƒè¯•

1. ä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·æ‰“å¼€é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„`dist`æ–‡ä»¶å¤¹
2. åœ¨å¼€å‘è€…å·¥å…·ä¸­é¢„è§ˆå’Œè°ƒè¯•å°ç¨‹åº

## æ ¸å¿ƒæ¨¡å—åˆ†å·¥

### ğŸ” tokenmanager.js - Tokenç”Ÿå‘½å‘¨æœŸç®¡ç†
- **èŒè´£**: Tokençš„åº•å±‚å­˜å‚¨å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†
- **æ ¸å¿ƒåŠŸèƒ½**:
  - Tokenå­˜å‚¨/è¯»å– (`setTokens`, `getAccessToken`)
  - è¿‡æœŸæ£€æŸ¥ (`isTokenExpired`, `checkTokenRemainingTime`)
  - è‡ªåŠ¨åˆ·æ–°å®šæ—¶å™¨ (`setupAutoRefresh`)
  - å›è°ƒæœºåˆ¶ (`setRefreshCallback`, `setExpiredCallback`)

### ğŸŒ http.js - HTTPè¯·æ±‚å¤„ç†å™¨
- **èŒè´£**: HTTPè¯·æ±‚å°è£…ã€æ‹¦æˆªå™¨å’Œé”™è¯¯å¤„ç†
- **æ ¸å¿ƒåŠŸèƒ½**:
  - è¯·æ±‚/å“åº”æ‹¦æˆªå™¨ (`processRequestConfig`, `processResponse`)
  - è‡ªåŠ¨æ·»åŠ Token (`addAuthToken`)
  - Tokenè¿‡æœŸå¤„ç† (`handleTokenExpired` - å§”æ‰˜ç»™user.js)--é¿å…å¾ªç¯
  - ç»Ÿä¸€é”™è¯¯å¤„ç† (`handleHttpError`, `showErrorToast`)
  - ä¾¿æ·è¯·æ±‚æ–¹æ³• (`get`, `post`, `put`, `delete`)

### ğŸ”Œ userinfo.js - ç™»å½•APIå°è£…
- **èŒè´£**: çº¯APIè°ƒç”¨ï¼Œä¸å¤„ç†çŠ¶æ€ç®¡ç†
- **æ ¸å¿ƒåŠŸèƒ½**:
  - å®Œæ•´ç™»å½• (`wxLogin` - å¸¦UIäº¤äº’)->è·Ÿç”¨æˆ·æœ‰äº¤äº’
  - é™é»˜ç™»å½• (`silentWxLogin` - æ— UIäº¤äº’)->ç”¨æˆ·æ— æ„Ÿï¼Œé˜²æ­¢æ‰“æ–­
  - ç”¨æˆ·ä¿¡æ¯è·å– (`getUserInfo`)
  - é€šç”¨APIè¯·æ±‚ (`apiRequest`)

### ğŸ‘¤ user.js - ç”¨æˆ·çŠ¶æ€ç®¡ç†
- **èŒè´£**: ç”¨æˆ·çŠ¶æ€ç®¡ç†å’Œç™»å½•æµç¨‹åè°ƒ
- **æ ¸å¿ƒåŠŸèƒ½**:
  - ç”¨æˆ·çŠ¶æ€ç®¡ç† (`userInfo`, `isLoggedIn`, `userStats`)
  - ç™»å½•æµç¨‹åè°ƒ (`login`, `silentLogin`, `checkAndEnsureLogin`)
  - çŠ¶æ€æŒä¹…åŒ– (`setLoginState`, `clearLoginState`)
  - Tokenåˆ·æ–°åè°ƒ (è°ƒç”¨userinfo.jsåæ›´æ–°tokenmanager.js)

### ğŸ“Š è°ƒç”¨é€»è¾‘

```
ç”¨æˆ·ç™»å½•æµç¨‹:
App â†’ user.js â†’ userinfo.js â†’ http.js â†’ åç«¯API
                     â†“
             tokenmanager.js (å­˜å‚¨token)

Tokenè‡ªåŠ¨åˆ·æ–°:
http.js (æ£€æµ‹è¿‡æœŸ) â†’ user.js (åè°ƒåˆ·æ–°) â†’ userinfo.js (é™é»˜ç™»å½•) 
                                              â†“
                              tokenmanager.js (æ›´æ–°token)
```

**ä¾èµ–å…³ç³»**: `tokenmanager.js`(åº•å±‚) â† `http.js` â† `userinfo.js` â† `user.js`(ä¸šåŠ¡å±‚)

## é¡¹ç›®ç‰¹æ€§

- **ä¸»é¢˜åˆ‡æ¢**: æ”¯æŒé»˜è®¤ä¸»é¢˜å’Œæ€€æ—§ä¸»é¢˜ï¼Œå¯éšæ—¶åˆ‡æ¢
- **å“åº”å¼è®¾è®¡**: é€‚é…ä¸åŒå°ºå¯¸çš„è®¾å¤‡å±å¹•
- **ç»„ä»¶åŒ–**: é«˜åº¦ç»„ä»¶åŒ–çš„è®¾è®¡ï¼Œæé«˜ä»£ç å¤ç”¨æ€§
- **çŠ¶æ€ç®¡ç†**: ä½¿ç”¨Piniaè¿›è¡Œå…¨å±€çŠ¶æ€ç®¡ç†
- **è‡ªå®šä¹‰å¯¼èˆªæ **: å®ç°äº†è‡ªå®šä¹‰çš„TabBarå¯¼èˆªç»„ä»¶
- **ç­›é€‰åŠŸèƒ½**: åœ¨æ—¥è®°é¡µé¢å®ç°äº†åˆ†ç±»ã€æ ‡ç­¾ã€æ—¥æœŸå’Œæœç´¢ç­›é€‰
- **Tokenè‡ªåŠ¨ç®¡ç†**: è‡ªåŠ¨åˆ·æ–°æœºåˆ¶ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥ç™»å½•çŠ¶æ€ç»´æŠ¤

## å¼€å‘æ³¨æ„äº‹é¡¹

1. **æ ·å¼éš”ç¦»**: å¾®ä¿¡å°ç¨‹åºä¸­çš„æ ·å¼æ˜¯éš”ç¦»çš„ï¼Œå…¨å±€æ ·å¼éœ€è¦åœ¨`app.css`ä¸­å¼•å…¥
2. **ä¸»é¢˜åˆ‡æ¢**: åœ¨ç»„ä»¶ä¸­ä½¿ç”¨`:class="themeStore.currentThemeClass"`åº”ç”¨ä¸»é¢˜
3. **å¯¼èˆªæ é¢œè‰²**: é¡µé¢åˆ‡æ¢æ—¶éœ€è¦è°ƒç”¨`themeStore.updateNavigationBarColor()`æ›´æ–°å¯¼èˆªæ é¢œè‰²
4. **TabBaræ¿€æ´»çŠ¶æ€**: é¡µé¢åŠ è½½æ—¶éœ€è¦è®¾ç½®å½“å‰é¡µé¢å¯¹åº”çš„TabBaræ¿€æ´»çŠ¶æ€

## è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»ºPull Request

